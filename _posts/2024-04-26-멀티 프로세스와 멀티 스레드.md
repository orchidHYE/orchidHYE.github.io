---
layout: post
title: "[운영체제] 멀티 프로세스와 멀티 스레드"
date: 2024-04-26 23:47 +0900
categories:
  - CS
  - OS
tags: 
math: true
---

## 스레드 (thread)
![](https://i.imgur.com/YVmwtUM.png)
- 프로세스를 구성하는 **실행 흐름의 단위**
- 하나의 프로세스는 하나 이상의 스레드를 가질 수 있다. 

 >###### 단일 스레드 프로세스
 >![](https://i.imgur.com/KQEkWWT.png)
> - 실행 흐름이 하나인 프로세스
>
>###### 멀티 스레드 프로세스
>![](https://i.imgur.com/oYnnzxT.png)
>- 실행 흐름이 여러 개인 프로세스
>- 프로세스를 이루는 명령어 동시 실행 가능
>	- 예를들어, 워드 프로세서 프로세스에서 자동 저장을 수행하고 있는 스레드, 입력을 수행하고 있는 스레드처럼 명령어를 동시에 실행할 수 있다.

<br/>

###### 스레드는 어떻게 구성되어 있길래 하나의 프로세스에서 여러개의 스레드가 실행될 수 있는가.

## 스레드 구성 요소
![](https://i.imgur.com/ZsQMalf.png)
- 스레드 ID
- 프로그램 카운터를 비롯한 레지스터 값
- 스택

###### 위와 같이 스레드는 실행에 필요한 최소한의 정보를 가지고 있다.
###### 스레드마다 각각의 프로그램 카운터, 스택 등을 가지고 있기 때문에 여러개의 스레드 실행이 가능한 것이다.

>※ 단, 하나의 프로세스에서 여러개의 스레드는 **프로세스의 자원을 공유**한다.

<br/>

## 멀티 프로세스 vs 멀티 스레드
![](https://i.imgur.com/yekW6J6.png)
 ###### 동일한 작업을 수행하는 <span style="color:red">단일 스레드 프로세스 여러 개</span> 실행과,
 ###### 하나의 프로세스를 <span style="color:red">여러 스레드로</span> 실행하는 것은 어떤 차이가 있을까.

> ###### 여러 프로세스
> ###### fork() 명령어로 세 개의 프로세스 생성
>![](https://i.imgur.com/w6l2bA0.png)
 >- 프로세스를 fork하면 코드/데이터/힙 영역 등 모든 자원이 복제되어 저장됨
>- 저장된 메모리 주소를 제외하면 모든 것이 동일한 프로세스 두 개가 통째로 메모리에 적재
> >※ fork 직후 같은 프로세스를 **통째로 메모리에 중복 저장하지 않으면서**<br/>
> 동시에 프로세스끼리 자원을 공유하지 않는 방법도 있다.<br/>
> 이를 `쓰기 식 복사 (copy on write)`기법이라고 한다.
> ###### 여러 스레드
> ![](https://i.imgur.com/FaVDPch.png)
>- 스레드들은 별도의 실행을 위해 꼭 필요한 스레드 ID, 프로그램 카운터 값을 포함한 레지스터 값, 스택을 갖는다.
>- 하지만 이 스레드들은 프로세스의 자원을 공유한다.

<br/>

## 정리
- 프로세스끼리는 자원을 공유하지 않는다. → `독립적으로 실행`
	- 프로세스 간에도 자원을 주고받을 수 있다 → 프로세스 간 통신 (IPC)
	- 파일을 통한 프로세스 간 통신, 공유 메모리를 통한 프로세스 간 통신 
- 스레드는 프로세스의 자원을 공유한다. → `협력과 통신 유리`
	- 하지만, 멀티 스레드가 때로는 문제가 될 수도 있다.
	- ![](https://i.imgur.com/x7tWdY4.png)
		- 멀티 프로세스는 하나의 프로세스에 문제가 발생하더라도 자원을 공유하고있지 않기 때문에, 다른 프로세스 실행에 지장이 적다.
		- 반면 멀티 스레드는 하나의 스레드에 문제가 발생하면 전체 프로세스에 문제가 발생할 수도 있다. (자원을 공유하고 있기 때문)
