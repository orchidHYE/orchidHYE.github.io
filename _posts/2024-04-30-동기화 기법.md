---
layout: post
title: "[운영체제] 동기화 기법"
date: 2024-05-01 22:01 +0900
categories:
  - CS
  - OS
tags: 
math: true
---
## 뮤텍스 락 (Mutex Lock)
- 상호 배제를 위한 동기화 도구

>###### 뮤텍스 락의 구조
>- Lock 전역  변수
>	- 락의 상태를 나타내는 변수
>	- 0일 때 언락 상태, 1일 때 락 상태
>- Lock 획득 함수 (Lock/Acquire)
>	- 스레드가 공유 자원에 접근하기 위해 락을 획득하려고 시도한다.
>	- 락이 이미 다른 스레드에 의해 획득되어 있다면, 해당 스레드는 락이 해제될 때까지 대기한다.
>- Lock 해제 함수 (Unlock/Release)
>	- 스레드가 공유 자원에 대한 작업을 마친 후, 락을 해제 한다.
>	- 이 후 다른 스레드가 락을 획득할 수 있게 된다.

<br/>

```java
private int lock = 0; // 초기값0, unlock 상태

public void acquire () {
	// 바쁜 대기 (busy waiting): 반복적으로 임계 구역이 잠겨있는지 확인하는 것.
	while (lock == 1) { // 임계 구역이 잠겨있다면
		; // 임계 구역이 잠겨 있는지를 반복적으로 확인
	}
	lock = 1; // 임계 구역이 잠겨 있지 않다면 임계 구역 잠금
}

public void release () {
	lock = 0; // 임계 구역 작업이 끝났으니 잠금 해제
}
```

## 세마포 (Semaphore)
- 뮤텍스 락보다 일반화된 방식의 동기화 도구
- 공유 자원이 여러 개 있는 경우에도 적용 가능

`세마포의 종류: 이진 세마포, 카운팅 세마포가 있다. 여기서는 카운팅 세마포를 다룬다.`

<br/>

![](https://i.imgur.com/lrl0e7P.png)
- 임계 구역 앞에서 멈춤 신호를 받으면 잠시 대기
- 임계 구역 앞에서 가도 좋다는 신호를 받으면 임계 구역 진입

```java
private int s = 0; // 초기값0

public void wait () {
	// 바쁜 대기 (busy waiting)
	while (s <= 0) { // 임계 구역에 진입할 수 있는 프로세스 개수가 0 이하라면
		; // 사용할 수 있는 자원이 있는지 반복적으로 확인
	}
	s--; // 임계 구역에 진입할 수 있는 프로세스 개수가 하나 이상이면 s 1감소시키고 임계 구역 진
}

public void signal () {
	s++; // 임계 구역에서의 작업을 마친 뒤 s 1 증가
}
```


###### 바쁜 대기 (busy waiting)
###### 반복적으로 확인 하는 것은 CPU 사이클 낭비이다.
###### 이러한 문제점의 해결 방법은
- 사용할 수 있는 자원이 없을 경우 **대기 상태**로 만듦 (해당 프로세스의 PCB를 대기 큐에 삽입)
- 사용할 수 있는 자원이 생겼을 경우 대기 큐의 프로세스를 **준비 상태**로 만듦 (해당 프로세스의 PCB를 대기 큐엣 꺼내 준비 큐에 삽입)

>- 세마포 방식은 임계 구역 앞뒤로 항상 wait(), signal() 호출을 해야한다는 단점이 있다.
>	-  임계구역 앞뒤로 세마포를 누락한 경우
>	- wait와 signal 순서를 헷갈린 경우
>	- wait와 signal을 중복해서 사용한 경우 등등의 실수가 발생할 수 있다.
>- 이러한 단점을 보완한 방식이 모니터이다.

<br/>

## 모니터 (Monitor)
![](https://i.imgur.com/nOZSTos.png)
- 상호 배제를 위한 동기화
- 인터페이스를 위한 큐
- 공유 자원에 접근하고자 하는 프로세스를 큐에 삽입
- 큐에 삽입된 순서대로 공유 자원 이용

>###### 실행 순서 제어를 위한 동기화
>![](https://i.imgur.com/UT9BdeQ.png)
>- 조건 변수 (condition variable)이용<br/>
>
>`프로세스나 스레드의 실행 순서를 제어하기 위해 사용하는 특별한 변수`<br/><br/>
>![](https://i.imgur.com/5raWeOt.png)
>- 조건변수.wait(): 대기 상태로 변경, 조건 변수에 대한 큐에 삽입
>![](https://i.imgur.com/t5laMpy.png)
>- 조건변수. signal(): wait()으로 대기 상태로 접어든 조건 변수를 실행 상태로 변경
><br/>
>###### 정리
>###### 모니터 안에는 하나의 프로세스만이 있을 수 있다.
>- wait()를 호출했던 프로세스는 signal()을 호출한 프로세스가 모니터를 떠난 뒤에 수행을 재개
>- signal()을 호출한 프로세스의 실행을 일시 중단하고 자신이 실행된 뒤 다시 signal()을 호출한 프로세스의 수행을 재개

